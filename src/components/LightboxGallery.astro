---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface GalleryImage {
  src: string | ImageMetadata;
  alt?: string;
  caption?: string;
}

interface Props {
  images: GalleryImage[];
  gallery?: string;
}

const { images = [], gallery = 'gallery' } = Astro.props as Props;
const id = gallery;
---

<div class="lightbox-gallery">
  {images.map((img) => {
    const isMeta = typeof img.src === 'object' && img.src !== null && 'src' in (img.src as any);
    return (
      <figure class="lightbox-figure" data-gallery={id}>
        {isMeta ? (
          <Image src={img.src as ImageMetadata} alt={img.alt ?? ''} data-lightbox="image" data-gallery={id} />
        ) : (
          <img src={img.src as string} alt={img.alt ?? ''} loading="lazy" decoding="async" data-lightbox="image" data-gallery={id} />
        )}
        {(img.caption || img.alt) && <figcaption>{img.caption || img.alt}</figcaption>}
      </figure>
    );
  })}
</div>
